<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    body { font-family: 'Pretendard', sans-serif; }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app">
    <!-- í—¤ë” -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p class="text-gray-500 mt-1">í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
          </div>
          <div class="flex gap-3">
            <a href="https://hyeyeon-portfolio.vercel.app" target="_blank" rel="noopener noreferrer" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center gap-2">
              <i data-lucide="arrow-left" class="w-4 h-4"></i>
              í™ˆìœ¼ë¡œ
            </a>
            <a href="/admin/create" id="createBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2" style="display: none;">
              <i data-lucide="plus" class="w-4 h-4"></i>
              ìƒˆ í”„ë¡œì íŠ¸
            </a>
            <button onclick="logout()" id="logoutBtn" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition flex items-center gap-2" style="display: none;">
              <i data-lucide="log-out" class="w-4 h-4"></i>
              ë¡œê·¸ì•„ì›ƒ
            </button>
          </div>
        </div>
      </div>
    </header>

      <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="max-w-7xl mx-auto px-4 pt-6 sm:px-6 lg:px-8">
        <div class="border-b border-gray-200">
          <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button
              onclick="switchTab('projects')"
              id="tab-projects"
              class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm active"
            >
              í”„ë¡œì íŠ¸ ê´€ë¦¬
            </button>
            <button
              onclick="switchTab('contacts')"
              id="tab-contacts"
              class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
            >
              ì—°ë½ ê´€ë¦¬
            </button>
            <button
              onclick="switchTab('visitors')"
              id="tab-visitors"
              class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
            >
              ë°©ë¬¸ì ê´€ë¦¬
            </button>
          </nav>
        </div>
      </div>

      <!-- í”„ë¡œì íŠ¸ ê´€ë¦¬ íƒ­ -->
      <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 tab-content" id="content-projects">
        <!-- ë§ˆì´ê·¸ë ˆì´ì…˜ ë²„íŠ¼ (ì¸ì¦ëœ ì‚¬ìš©ìë§Œ í‘œì‹œ) -->
        <div id="migrate-section" class="mb-6" style="display: none;">
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-sm font-semibold text-yellow-800 mb-1">ì •ì  í”„ë¡œì íŠ¸ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜</h3>
                <p class="text-xs text-yellow-700">FOì˜ ì •ì  í”„ë¡œì íŠ¸ ë°ì´í„°(9ê°œ)ë¥¼ MongoDBë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
              </div>
              <button
                onclick="migrateProjects()"
                id="migrateBtn"
                class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition flex items-center gap-2 text-sm"
              >
                <i data-lucide="database" class="w-4 h-4"></i>
                ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
              </button>
            </div>
          </div>
        </div>

        <!-- í”„ë¡œì íŠ¸ í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="project-stats">
        <!-- í”„ë¡œì íŠ¸ í†µê³„ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>

      <!-- í”„ë¡œì íŠ¸ ëª©ë¡ -->
      <div class="bg-white rounded-xl shadow-sm border">
        <div class="px-6 py-4 border-b">
          <h2 class="text-xl font-semibold text-gray-900">í”„ë¡œì íŠ¸ ëª©ë¡</h2>
        </div>

        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50 border-b">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì œëª©</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì¹´í…Œê³ ë¦¬</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">íƒœê·¸</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ëŒ€í‘œ</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ë‚ ì§œ</th>
                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">ì‘ì—…</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200" id="projectsTable">
              <!-- í”„ë¡œì íŠ¸ ëª©ë¡ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
            </tbody>
          </table>
        </div>
      </div>
      </div>

      <!-- ì—°ë½ ê´€ë¦¬ íƒ­ -->
      <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 tab-content hidden" id="content-contacts">
        <div class="bg-white rounded-xl shadow-sm border">
          <div class="px-6 py-4 border-b">
            <h2 class="text-xl font-semibold text-gray-900">ì—°ë½ ê´€ë¦¬</h2>
            <p class="text-sm text-gray-500 mt-1">í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸ë¥¼ í†µí•´ ë°›ì€ ì—°ë½ ë‚´ì—­</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë‚ ì§œ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë©”ì¼</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë©”ì‹œì§€</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody id="contactsTable" class="bg-white divide-y divide-gray-200">
                <!-- ì—°ë½ ëª©ë¡ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ë°©ë¬¸ì ê´€ë¦¬ íƒ­ -->
      <div class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8 tab-content hidden" id="content-visitors">
        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="visitor-stats">
          <!-- ë°©ë¬¸ì í†µê³„ëŠ” JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- ë°©ë¬¸ì ëª©ë¡ -->
        <div class="bg-white rounded-xl shadow-sm border">
          <div class="px-6 py-4 border-b">
            <h2 class="text-xl font-semibold text-gray-900">ë°©ë¬¸ì ê¸°ë¡</h2>
            <p class="text-sm text-gray-500 mt-1">ìµœê·¼ ë°©ë¬¸í•œ ì‚¬ìš©ì ëª©ë¡ (ìµœì‹ ìˆœ)</p>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë°©ë¬¸ ì‹œê°„</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê²½ë¡œ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">IP ì£¼ì†Œ</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User Agent</th>
                </tr>
              </thead>
              <tbody id="visitorsTable" class="bg-white divide-y divide-gray-200">
                <!-- ë°©ë¬¸ì ëª©ë¡ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // í”„ë¡œë•ì…˜ì—ì„œëŠ” ê°™ì€ ë„ë©”ì¸ì˜ /api/bo ê²½ë¡œ ì‚¬ìš©, ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë³„ë„ ì„œë²„ ì‚¬ìš©
    const API_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3005/api'
      : '/api/bo';
    const categoryLabels = {
      'new': 'ì‹ ê·œ',
      'renewal': 'ë¦¬ë‰´ì–¼',
      'app': 'ì•±',
      'web': 'ì›¹',
      'proposal': 'ê¸°íšì•ˆ',
      'usability': 'ì‚¬ìš©ì„±í‰ê°€',
    };

    let projects = [];
    let contacts = [];
    let isAuthenticated = false; // ë¡œê·¸ì¸ ìƒíƒœ
    let currentTab = 'projects'; // í˜„ì¬ í™œì„± íƒ­

    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    async function checkAuth() {
      try {
        const response = await fetch(`${API_URL}/auth/check`, {
          credentials: 'include'
        });
        const result = await response.json();
        isAuthenticated = result.authenticated || false;
        
        // ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ UI ì—…ë°ì´íŠ¸
        updateUIForAuth();
      } catch (error) {
        console.error('ì¸ì¦ í™•ì¸ ì˜¤ë¥˜:', error);
        isAuthenticated = false;
        updateUIForAuth();
      }
    }

    // ì¸ì¦ ìƒíƒœì— ë”°ë¼ UI ì—…ë°ì´íŠ¸
    function updateUIForAuth() {
      // ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼
      const createBtn = document.getElementById('createBtn');
      if (createBtn) {
        createBtn.style.display = isAuthenticated ? 'flex' : 'none';
      }

      // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.style.display = isAuthenticated ? 'flex' : 'none';
      }

      // ë§ˆì´ê·¸ë ˆì´ì…˜ ì„¹ì…˜
      const migrateSection = document.getElementById('migrate-section');
      if (migrateSection) {
        migrateSection.style.display = isAuthenticated ? 'block' : 'none';
      }

      // í”„ë¡œì íŠ¸ í…Œì´ë¸”ì˜ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ë“¤ (í´ë˜ìŠ¤ë¡œ ì„ íƒ)
      const editButtons = document.querySelectorAll('.edit-btn');
      const deleteButtons = document.querySelectorAll('.delete-btn');
      const toggleButtons = document.querySelectorAll('.toggle-btn');
      
      editButtons.forEach(btn => {
        btn.style.display = isAuthenticated ? 'inline-flex' : 'none';
      });
      deleteButtons.forEach(btn => {
        btn.style.display = isAuthenticated ? 'inline-flex' : 'none';
      });
      toggleButtons.forEach(btn => {
        btn.style.display = isAuthenticated ? 'inline-block' : 'none';
      });
    }

    // íƒ­ ì „í™˜ í•¨ìˆ˜
    async function switchTab(tabName) {
      console.log('íƒ­ ì „í™˜:', tabName);
      currentTab = tabName;
      
      // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-blue-500', 'text-blue-600');
        btn.classList.add('border-transparent', 'text-gray-500');
      });
      
      // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
      });
      
      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      const activeTab = document.getElementById(`tab-${tabName}`);
      const activeContent = document.getElementById(`content-${tabName}`);
      
      console.log('í™œì„± íƒ­ ë²„íŠ¼:', activeTab);
      console.log('í™œì„± ì½˜í…ì¸ :', activeContent);
      
      if (activeTab) {
        activeTab.classList.remove('border-transparent', 'text-gray-500');
        activeTab.classList.add('border-blue-500', 'text-blue-600');
      }
      
      if (activeContent) {
        activeContent.classList.remove('hidden');
        console.log('ì½˜í…ì¸  í‘œì‹œë¨:', tabName);
      } else {
        console.error('ì½˜í…ì¸ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', `content-${tabName}`);
      }
      
      // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
      try {
        if (tabName === 'projects') {
          await loadProjects();
        } else if (tabName === 'contacts') {
          await loadContacts();
        } else if (tabName === 'visitors') {
          await loadVisitors();
          await loadVisitorStatsForTab();
        }
      } catch (error) {
        console.error('íƒ­ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (HTMLì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
    window.switchTab = switchTab;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', async () => {
      await checkAuth();
      
      // ì´ˆê¸° íƒ­ ì„¤ì • (ë°ì´í„° ë¡œë“œëŠ” switchTabì—ì„œ ì²˜ë¦¬)
      await switchTab('projects');
      
      // 30ì´ˆë§ˆë‹¤ í˜„ì¬ íƒ­ ë°ì´í„° ìë™ ê°±ì‹ 
      setInterval(async () => {
        if (currentTab === 'projects') {
          await loadProjects();
        } else if (currentTab === 'contacts') {
          await loadContacts();
        } else if (currentTab === 'visitors') {
          await loadVisitors();
          await loadVisitorStatsForTab();
        }
      }, 30000);
    });

    // ì—°ë½ ëª©ë¡ ë¡œë“œ
    async function loadContacts() {
      try {
        const response = await fetch(`${API_URL}/contacts`);
        const result = await response.json();
        if (result.success && Array.isArray(result.data)) {
          contacts = result.data;
          renderContacts(result.data);
        } else {
          renderContacts([]);
        }
      } catch (error) {
        console.error('ì—°ë½ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        renderContacts([]);
      }
    }

    // ì—°ë½ ëª©ë¡ ë Œë”ë§
    function renderContacts(contactsList) {
      const tbody = document.getElementById('contactsTable');
      
      if (!contactsList || contactsList.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-6 py-12 text-center">
              <div class="text-gray-400">
                <p class="text-4xl mb-4">ğŸ“§</p>
                <p class="text-lg">ì—°ë½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = contactsList.map(contact => {
        const contactDate = new Date(contact.createdAt || contact.date || Date.now());
        const formattedDate = contactDate.toLocaleString('ko-KR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        });
        
        const message = contact.message || '';
        const shortMessage = message.length > 50 
          ? message.substring(0, 50) + '...' 
          : message;
        
        const status = contact.read ? 'ì½ìŒ' : 'ì½ì§€ ì•ŠìŒ';
        const statusColor = contact.read ? 'text-green-600' : 'text-blue-600';
        
        return `
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">${formattedDate}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">${contact.name || '-'}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-500">${contact.email || '-'}</div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm text-gray-500" title="${message}">${shortMessage}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 text-xs font-medium rounded-full ${statusColor}">${status}</span>
            </td>
          </tr>
        `;
      }).join('');
    }

    // ë°©ë¬¸ì ëª©ë¡ ë¡œë“œ
    async function loadVisitors() {
      try {
        const response = await fetch(`${API_URL}/visitors?limit=50`);
        const result = await response.json();
        if (result.success && Array.isArray(result.data)) {
          renderVisitors(result.data);
        }
      } catch (error) {
        console.error('ë°©ë¬¸ì ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ë°©ë¬¸ì í†µê³„ ë¡œë“œ (ë°©ë¬¸ì ê´€ë¦¬ íƒ­ìš©)
    async function loadVisitorStatsForTab() {
      try {
        const response = await fetch(`${API_URL}/visitors/stats`);
        const result = await response.json();
        if (result.success) {
          renderVisitorStats(result);
        }
      } catch (error) {
        console.error('ë°©ë¬¸ì í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ë°©ë¬¸ì í†µê³„ ë Œë”ë§ (ë°©ë¬¸ì ê´€ë¦¬ íƒ­ìš©)
    function renderVisitorStats(stats) {
      const statsHtml = `
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">ì˜¤ëŠ˜ ë°©ë¬¸ì</p>
              <p class="text-3xl font-bold text-gray-900 mt-1">${stats.today || 0}</p>
            </div>
            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
              <span class="text-2xl">ğŸ‘¥</span>
            </div>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">ì „ì²´ ë°©ë¬¸ì</p>
              <p class="text-3xl font-bold text-gray-900 mt-1">${stats.total || 0}</p>
            </div>
            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <span class="text-2xl">ğŸ“Š</span>
            </div>
          </div>
        </div>
      `;
      const statsContainer = document.getElementById('visitor-stats');
      if (statsContainer) {
        statsContainer.innerHTML = statsHtml;
      }
    }

    // ë°©ë¬¸ì ëª©ë¡ ë Œë”ë§
    function renderVisitors(visitors) {
      const tbody = document.getElementById('visitorsTable');
      
      if (visitors.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" class="px-6 py-12 text-center">
              <div class="text-gray-400">
                <p class="text-4xl mb-4">ğŸ‘¤</p>
                <p class="text-lg">ë°©ë¬¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</p>
              </div>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = visitors.map(visitor => {
        const visitDate = new Date(visitor.date || visitor.createdAt);
        const formattedDate = visitDate.toLocaleString('ko-KR', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        });
        
        const userAgent = visitor.userAgent || '';
        const shortUserAgent = userAgent.length > 50 
          ? userAgent.substring(0, 50) + '...' 
          : userAgent;
        
        return `
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">${formattedDate}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-900">${visitor.path || '/'}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm text-gray-500">${visitor.ip || '-'}</div>
            </td>
            <td class="px-6 py-4">
              <div class="text-sm text-gray-500" title="${userAgent}">${shortUserAgent}</div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // í”„ë¡œì íŠ¸ ë¡œë“œ
    // ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í•¨ìˆ˜
    async function migrateProjects() {
      const migrateBtn = document.getElementById('migrateBtn');
      if (!migrateBtn) return;
      
      if (!confirm('ì •ì  í”„ë¡œì íŠ¸ ë°ì´í„°(9ê°œ)ë¥¼ MongoDBë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê¸°ì¡´ í”„ë¡œì íŠ¸ëŠ” ì—…ë°ì´íŠ¸ë˜ê³ , ì—†ëŠ” í”„ë¡œì íŠ¸ëŠ” ì¶”ê°€ë©ë‹ˆë‹¤.')) {
        return;
      }
      
      const originalText = migrateBtn.innerHTML;
      migrateBtn.disabled = true;
      migrateBtn.innerHTML = '<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘...';
      
      try {
        const response = await fetch(`${API_URL}/migrate/projects`, {
          method: 'POST',
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        // ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
          const text = await response.text();
          console.error('âŒ JSONì´ ì•„ë‹Œ ì‘ë‹µ:', text.substring(0, 200));
          throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
        }
        
        const result = await response.json();
        
        if (result.success) {
          alert(`âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!\n\nì¶”ê°€: ${result.added}ê°œ\nì—…ë°ì´íŠ¸: ${result.updated}ê°œ\nì‹¤íŒ¨: ${result.skipped}ê°œ\n\nì´ ${result.total}ê°œì˜ í”„ë¡œì íŠ¸ê°€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
          // í”„ë¡œì íŠ¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          await loadProjects();
        } else {
          alert(`âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
        }
      } catch (error) {
        console.error('ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜:', error);
        alert(`âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
      } finally {
        migrateBtn.disabled = false;
        migrateBtn.innerHTML = originalText;
        lucide.createIcons();
      }
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.migrateProjects = migrateProjects;

    async function loadProjects() {
      try {
        const response = await fetch(`${API_URL}/projects`);
        const result = await response.json();
        if (result.success) {
          projects = result.data || [];
          renderProjects();
          renderProjectStats(); // í”„ë¡œì íŠ¸ í†µê³„ë§Œ ë Œë”ë§
        } else {
          console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', result);
          renderProjects(); // ë¹ˆ ë°°ì—´ë¡œë¼ë„ ë Œë”ë§
          renderProjectStats();
        }
      } catch (error) {
        console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
        projects = [];
        renderProjects(); // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë¹ˆ ëª©ë¡ í‘œì‹œ
        renderProjectStats();
      }
    }

    // ë°©ë¬¸ì í†µê³„
    let visitorStats = { today: 0, total: 0 };

    // ë°©ë¬¸ì í†µê³„ ë¡œë“œ
    async function loadVisitorStats() {
      try {
        const response = await fetch(`${API_URL}/visitors/stats`);
        const result = await response.json();
        console.log('ë°©ë¬¸ì í†µê³„ ì‘ë‹µ:', result);
        if (result.success) {
          visitorStats = {
            today: result.today || 0,
            total: result.total || 0
          };
          console.log('ë°©ë¬¸ì í†µê³„ ì—…ë°ì´íŠ¸:', visitorStats);
        } else {
          console.error('ë°©ë¬¸ì í†µê³„ ì¡°íšŒ ì‹¤íŒ¨:', result);
        }
      } catch (error) {
        console.error('ë°©ë¬¸ì í†µê³„ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // í”„ë¡œì íŠ¸ í†µê³„ ë Œë”ë§ (í”„ë¡œì íŠ¸ ê´€ë¦¬ íƒ­ìš©)
    function renderProjectStats() {
      const statsHtml = `
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">ì´ í”„ë¡œì íŠ¸</p>
              <p class="text-3xl font-bold text-gray-900 mt-1">${projects.length}</p>
            </div>
            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
              <span class="text-2xl">ğŸ“</span>
            </div>
          </div>
        </div>
        <div class="bg-white p-6 rounded-xl shadow-sm border">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-gray-500 text-sm">ëŒ€í‘œ í”„ë¡œì íŠ¸</p>
              <p class="text-3xl font-bold text-gray-900 mt-1">${projects.filter(p => p.featured).length}</p>
            </div>
            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
              <i data-lucide="pin" class="w-6 h-6 text-yellow-600" fill="currentColor"></i>
            </div>
          </div>
        </div>
      `;
      const statsContainer = document.getElementById('project-stats');
      if (statsContainer) {
        statsContainer.innerHTML = statsHtml;
        lucide.createIcons();
      }
    }

    // í”„ë¡œì íŠ¸ ëª©ë¡ ë Œë”ë§
    function renderProjects() {
      const tbody = document.getElementById('projectsTable');
      
      if (projects.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-12 text-center">
              <div class="text-gray-400">
                <p class="text-4xl mb-4">ğŸ“¦</p>
                <p class="text-lg">í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                <a href="/admin/create" class="text-blue-600 hover:text-blue-700 mt-2 inline-block">
                  ì²« í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš” â†’
                </a>
              </div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = projects.map(project => {
        const projectId = project._id || project.id;
        return `
        <tr class="hover:bg-gray-50">
          <td class="px-6 py-4">
            <div>
              <div class="text-sm font-medium text-gray-900">${project.title}</div>
              <div class="text-sm text-gray-500 truncate max-w-xs">${project.subtitle || ''}</div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
              ${categoryLabels[project.category] || project.category}
            </span>
          </td>
          <td class="px-6 py-4">
            <div class="flex flex-wrap gap-1">
              ${(project.tags || []).slice(0, 2).map(tag => `
                <span class="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600">${tag}</span>
              `).join('')}
              ${(project.tags || []).length > 2 ? `
                <span class="px-2 py-1 text-xs text-gray-400">+${(project.tags || []).length - 2}</span>
              ` : ''}
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <button onclick="toggleFeatured('${projectId}')" class="hover:scale-110 transition-transform toggle-btn" title="${project.featured ? 'ëŒ€í‘œ í”„ë¡œì íŠ¸ í•´ì œ' : 'ëŒ€í‘œ í”„ë¡œì íŠ¸ë¡œ ì„¤ì •'}" style="display: none;">
              <i data-lucide="${project.featured ? 'pin' : 'pin-off'}" class="w-6 h-6 ${project.featured ? 'text-yellow-600' : 'text-gray-400'}" fill="${project.featured ? 'currentColor' : 'none'}"></i>
            </button>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${project.date || ''}</td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex justify-end gap-2">
              <button onclick="viewDetail('${projectId}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded transition" title="ìƒì„¸ ë³´ê¸°">
                <i data-lucide="eye" class="w-4 h-4"></i>
              </button>
              <button onclick="editProject('${projectId}')" class="p-2 text-blue-600 hover:bg-blue-50 rounded transition edit-btn" title="ìˆ˜ì •" style="display: none;">
                <i data-lucide="edit-3" class="w-4 h-4"></i>
              </button>
              <button onclick="deleteProject('${projectId}')" class="p-2 text-red-600 hover:bg-red-50 rounded transition delete-btn" title="ì‚­ì œ" style="display: none;">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
              </button>
            </div>
          </td>
        </tr>
      `;
      }).join('');
      lucide.createIcons();
      
      // UI ì—…ë°ì´íŠ¸ (ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€)
      updateUIForAuth();
    }

    // ëŒ€í‘œ í”„ë¡œì íŠ¸ í† ê¸€
    async function toggleFeatured(id) {
      if (!isAuthenticated) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      const project = projects.find(p => p.id === id || p._id === id);
      if (!project) return;

      try {
        // MongoDB _id ë˜ëŠ” id ì‚¬ìš©
        const projectId = project._id || project.id;
        const response = await fetch(`${API_URL}/projects/${projectId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...project, featured: !project.featured })
        });
        const result = await response.json();
        if (result.success) {
            await loadProjects();
        }
      } catch (error) {
        console.error('í† ê¸€ ì˜¤ë¥˜:', error);
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í”„ë¡œì íŠ¸ ì‚­ì œ
    async function deleteProject(id) {
      if (!isAuthenticated) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      try {
        const project = projects.find(p => p.id === id || p._id === id);
        if (!project) {
          alert('í”„ë¡œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        // MongoDB _id ë˜ëŠ” id ì‚¬ìš©
        const projectId = project._id || project.id;
        const response = await fetch(`${API_URL}/projects/${projectId}`, {
          method: 'DELETE'
        });
        const result = await response.json();
        if (result.success) {
          alert('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
          await loadProjects();
        }
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // í”„ë¡œì íŠ¸ ìƒì„¸ ë³´ê¸°
    async function viewDetail(id) {
      const project = projects.find(p => p.id === id || p._id === id);
      if (!project) return;

      const projectId = project._id || project.id;
      
      // íŒŒì¼ ëª©ë¡ ë¡œë“œ
      let files = [];
      try {
        const filesResponse = await fetch(`${API_URL}/projects/${projectId}/files`);
        const filesResult = await filesResponse.json();
        if (filesResult.success && Array.isArray(filesResult.data)) {
          files = filesResult.data;
        }
      } catch (error) {
        console.error('íŒŒì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
      }

      const detailHtml = `
        <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onclick="this.remove()">
          <div class="bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
              <h2 class="text-2xl font-bold text-gray-900">${project.title}</h2>
              <button onclick="this.closest('.fixed').remove()" class="p-2 hover:bg-gray-100 rounded-full transition">
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
            <div class="p-6 space-y-6">
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-1">ë¶€ì œëª©</h3>
                <p class="text-lg text-gray-900">${project.subtitle || ''}</p>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500 mb-1">ì„¤ëª…</h3>
                <p class="text-gray-700">${project.description || ''}</p>
              </div>
              ${project.fullDescription ? `
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-1">ìƒì„¸ ì„¤ëª…</h3>
                  <p class="text-gray-700 whitespace-pre-line">${project.fullDescription}</p>
                </div>
              ` : ''}
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-1">ì¹´í…Œê³ ë¦¬</h3>
                  <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">${categoryLabels[project.category] || project.category}</span>
                </div>
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-1">ë‚ ì§œ</h3>
                  <p class="text-gray-700">${project.date || ''}</p>
                </div>
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-1">ì—­í• </h3>
                  <p class="text-gray-700">${project.role || ''}</p>
                </div>
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-1">ê¸°ê°„</h3>
                  <p class="text-gray-700">${project.duration || ''}</p>
                </div>
              </div>
              ${(project.tags || []).length > 0 ? `
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-2">íƒœê·¸</h3>
                  <div class="flex flex-wrap gap-2">
                    ${(project.tags || []).map(tag => `
                      <span class="px-3 py-1 text-sm rounded-full bg-gray-100 text-gray-700">${tag}</span>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
              ${(project.achievements || []).length > 0 ? `
                <div>
                  <h3 class="text-sm font-medium text-gray-500 mb-2">ì£¼ìš” ì„±ê³¼</h3>
                  <ul class="list-disc list-inside space-y-1 text-gray-700">
                    ${(project.achievements || []).map(achievement => `
                      <li>${achievement}</li>
                    `).join('')}
                  </ul>
                </div>
              ` : ''}
              <!-- íŒŒì¼ ê´€ë¦¬ ì„¹ì…˜ -->
              <div class="border-t pt-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">í”„ë¡œì íŠ¸ íŒŒì¼</h3>
                ${files.length > 0 ? `
                  <div class="space-y-2">
                    ${files.map((file, index) => `
                      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div class="flex items-center gap-3">
                          <i data-lucide="file-image" class="w-5 h-5 text-blue-600"></i>
                          <span class="text-sm text-gray-700">${file.name}</span>
                        </div>
                        <div class="flex gap-2">
                          <a href="${file.url}" target="_blank" class="p-2 text-blue-600 hover:bg-blue-50 rounded transition" title="ë¯¸ë¦¬ë³´ê¸°">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                          </a>
                          <button onclick="downloadFile('${projectId}', '${file.name}')" class="p-2 text-green-600 hover:bg-green-50 rounded transition" title="ë‹¤ìš´ë¡œë“œ">
                            <i data-lucide="download" class="w-4 h-4"></i>
                          </button>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                ` : `
                  <div class="text-center py-8 text-gray-400">
                    <i data-lucide="file-x" class="w-12 h-12 mx-auto mb-2"></i>
                    <p>ë“±ë¡ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                  </div>
                `}
              </div>
            </div>
            <div class="sticky bottom-0 bg-white border-t px-6 py-4 flex justify-end gap-3">
              ${isAuthenticated ? `
              <button onclick="editProject('${project.id}'); this.closest('.fixed').remove();" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                ìˆ˜ì •í•˜ê¸°
              </button>
              ` : ''}
              <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                ë‹«ê¸°
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', detailHtml);
      lucide.createIcons();
    }
    
    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function downloadFile(projectId, filename) {
      const downloadUrl = `${API_URL}/projects/${projectId}/files/${encodeURIComponent(filename)}`;
      const link = document.createElement('a');
      link.href = downloadUrl;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.viewDetail = viewDetail;
    window.downloadFile = downloadFile;

    // í”„ë¡œì íŠ¸ ìˆ˜ì •
    function editProject(id) {
      if (!isAuthenticated) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }
      const project = projects.find(p => p.id === id || p._id === id);
      if (!project) return;

      // ìˆ˜ì • í¼ ëª¨ë‹¬
      const editHtml = `
        <div class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onclick="this.remove()">
          <div class="bg-white rounded-2xl shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
              <h2 class="text-2xl font-bold text-gray-900">í”„ë¡œì íŠ¸ ìˆ˜ì •</h2>
              <button onclick="this.closest('.fixed').remove()" class="p-2 hover:bg-gray-100 rounded-full transition">
                <i data-lucide="x" class="w-6 h-6"></i>
              </button>
            </div>
            <form id="editForm" class="p-6 space-y-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª© *</label>
                <input type="text" name="title" value="${project.title || ''}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ë¶€ì œëª©</label>
                <input type="text" name="subtitle" value="${project.subtitle || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì„¤ëª… *</label>
                <textarea name="description" required rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${project.description || ''}</textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ìƒì„¸ ì„¤ëª…</label>
                <textarea name="fullDescription" rows="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${project.fullDescription || ''}</textarea>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬ *</label>
                  <select name="category" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="new" ${project.category === 'new' ? 'selected' : ''}>ì‹ ê·œ</option>
                    <option value="renewal" ${project.category === 'renewal' ? 'selected' : ''}>ë¦¬ë‰´ì–¼</option>
                    <option value="app" ${project.category === 'app' ? 'selected' : ''}>ì•±</option>
                    <option value="web" ${project.category === 'web' ? 'selected' : ''}>ì›¹</option>
                    <option value="proposal" ${project.category === 'proposal' ? 'selected' : ''}>ê¸°íšì•ˆ</option>
                    <option value="usability" ${project.category === 'usability' ? 'selected' : ''}>ì‚¬ìš©ì„±í‰ê°€</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                  <input type="text" name="tags" value="${(project.tags || []).join(', ')}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
              </div>
              <div class="grid grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ë‚ ì§œ</label>
                  <input type="text" name="date" value="${project.date || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">íŒ€ êµ¬ì„±</label>
                  <input type="text" name="team" value="${project.team || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ê¸°ê°„</label>
                  <input type="text" name="duration" value="${project.duration || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ì—­í• </label>
                  <input type="text" name="role" value="${project.role || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">ë§í¬</label>
                  <input type="text" name="link" value="${project.link || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ì£¼ìš” ì„±ê³¼ (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
                <textarea name="achievements" rows="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg">${(project.achievements || []).join('\\n')}</textarea>
              </div>
              <div>
                <label class="flex items-center">
                  <input type="checkbox" name="featured" ${project.featured ? 'checked' : ''} class="w-4 h-4 text-blue-600 border-gray-300 rounded" />
                  <i data-lucide="pin" class="w-4 h-4 text-yellow-600 ml-2" fill="currentColor"></i>
                  <span class="ml-2 text-sm text-gray-700">ëŒ€í‘œ í”„ë¡œì íŠ¸ë¡œ ê³ ì •</span>
                </label>
              </div>
              <div class="flex gap-4 pt-4">
                <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition font-medium">
                  ìˆ˜ì • ì™„ë£Œ
                </button>
                <button type="button" onclick="this.closest('.fixed').remove()" class="px-8 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition">
                  ì·¨ì†Œ
                </button>
              </div>
            </form>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', editHtml);
      
      // ìˆ˜ì • í¼ ì œì¶œ ì²˜ë¦¬
      document.getElementById('editForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const projectId = project._id || project.id;
        const updateData = {
          title: formData.get('title'),
          subtitle: formData.get('subtitle') || '',
          description: formData.get('description'),
          fullDescription: formData.get('fullDescription') || formData.get('description') || '',
          category: formData.get('category'),
          tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()).filter(Boolean) : [],
          date: formData.get('date') || '',
          team: formData.get('team') || '',
          role: formData.get('role') || '',
          duration: formData.get('duration') || '',
          link: formData.get('link') || '',
          achievements: formData.get('achievements') ? formData.get('achievements').split('\\n').map(a => a.trim()).filter(Boolean) : [],
          featured: formData.get('featured') === 'on',
        };

        try {
          const response = await fetch(`${API_URL}/projects/${projectId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updateData)
          });
          const result = await response.json();
          if (result.success) {
            alert('í”„ë¡œì íŠ¸ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            e.target.closest('.fixed').remove();
            await loadProjects();
          } else {
            alert('ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        } catch (error) {
          console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
      
      lucide.createIcons();
    }

    // ë¡œê·¸ì•„ì›ƒ
    async function logout() {
      if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });
        const result = await response.json();
        if (result.success) {
          window.location.href = '/admin/login';
        }
      } catch (error) {
        console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
        alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì¤‘ë³µ ì œê±°ë¨ (ìœ„ì— ì´ë¯¸ ì •ì˜ë¨)
    lucide.createIcons();
  </script>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200 mt-16">
    <div class="max-w-7xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
      <!-- Footer ìƒë‹¨ -->
      <div class="mb-8">
        <div class="max-w-2xl">
          <h3 class="text-2xl md:text-3xl font-light text-gray-900 mb-3">
            ì¥í˜œì—°
          </h3>
          <p class="text-base text-gray-600 leading-relaxed">
            ë§‰ë‹¤ë¥¸ ê¸¸ì—ì„œë„ ë˜ ë‹¤ë¥¸ ê²½ë¡œë¥¼ ì°¾ì•„ë‚´ëŠ”<br />
            <span class="font-bold">ë‚´ë¹„ê²Œì´ì…˜ ê°™ì€ ê¸°íšì</span>ì…ë‹ˆë‹¤.
          </p>
        </div>
      </div>

      <!-- êµ¬ë¶„ì„  -->
      <div class="h-px bg-gray-200 mb-8" />

      <!-- Footer í•˜ë‹¨ -->
      <div class="flex flex-col md:flex-row justify-between items-center gap-6">
        <p class="text-sm text-gray-500">
          Â© 2025 Jang Haeyeon Portfolio All rights reserved.
        </p>
        
        <div class="flex items-center gap-6 text-sm">
          <a href="/admin/viewer" class="text-gray-500 hover:text-blue-600 transition-colors flex items-center gap-2">
            <i data-lucide="eye" class="w-4 h-4"></i>
            Viewer Access
          </a>
          <a href="/" class="text-gray-500 hover:text-blue-600 transition-colors flex items-center gap-2">
            <i data-lucide="home" class="w-4 h-4"></i>
            í¬íŠ¸í´ë¦¬ì˜¤ í™ˆ
          </a>
        </div>
      </div>
    </div>
  </footer>
  
  <script>
    // Footer ì•„ì´ì½˜ ì´ˆê¸°í™”
    lucide.createIcons();
  </script>
</body>
</html>

